<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bioacoustics Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet"/>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; background-color: #f9f9f9; }
    h2 { border-bottom: 2px solid #ccc; padding-bottom: 0.25em; }
    .section { margin-bottom: 3em; background-color: #fff; padding: 1em; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .card { margin-top: 1em; }
    canvas { background-color: #fff; border: 1px solid #ddd; padding: 1em; margin-bottom: 1em; }
    .filter, .download-btns { margin-bottom: 1em; }
  </style>
</head>
<body>
  <h1>Bioacoustics Data Dashboard</h1>

  <div class="section" id="sites-section">
    <h2>Sites Data</h2>
    <input type="text" id="siteFilter" class="filter" placeholder="Filter Sites..." onkeyup="filterData('siteTable', this.value)">
    <div class="download-btns">
      <button onclick="downloadChartAs('sitesChart', 'sites-data', 'png')">Download PNG</button>
      <button onclick="downloadChartAs('sitesChart', 'sites-data', 'pdf')">Download PDF</button>
    </div>
    <canvas id="sitesChart"></canvas>
    <table id="siteTable"></table>
  </div>

  <div class="section" id="species-section">
    <h2>Species Data</h2>
    <input type="text" id="speciesFilter" class="filter" placeholder="Filter Species..." onkeyup="filterData('speciesTable', this.value)">
    <div class="download-btns">
      <button onclick="downloadChartAs('speciesChart', 'species-data', 'png')">Download PNG</button>
      <button onclick="downloadChartAs('speciesChart', 'species-data', 'pdf')">Download PDF</button>
    </div>
    <canvas id="speciesChart"></canvas>
    <div id="networkGraph" style="height: 400px;"></div>
    <table id="speciesTable"></table>
  </div>

  <div class="section" id="templates-section">
    <h2>Templates Insights</h2>
    <div class="download-btns">
      <button onclick="downloadChartAs('topSpeciesChart', 'top-species', 'png')">Download Top Species (PNG)</button>
      <button onclick="downloadChartAs('topSpeciesChart', 'top-species', 'pdf')">Download Top Species (PDF)</button>
    </div>
    <canvas id="topSpeciesChart"></canvas>
    <canvas id="avgDurationChart"></canvas>
    <canvas id="freqRangeChart"></canvas>
    <canvas id="templatesPerSiteChart"></canvas>
  </div>

  <script>
    function filterData(tableId, filter) {
      const table = document.getElementById(tableId);
      const rows = table.getElementsByTagName("tr");
      for (let i = 1; i < rows.length; i++) {
        const cells = rows[i].getElementsByTagName("td");
        let matched = false;
        for (let j = 0; j < cells.length; j++) {
          if (cells[j].textContent.toLowerCase().includes(filter.toLowerCase())) {
            matched = true; break;
          }
        }
        rows[i].style.display = matched ? "" : "none";
      }
    }

    function downloadChartAs(canvasId, filename, type) {
      const canvas = document.getElementById(canvasId);
      html2canvas(canvas).then(canvas => {
        if (type === 'png') {
          canvas.toBlob(blob => saveAs(blob, filename + '.png'));
        } else if (type === 'pdf') {
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF();
          const imgData = canvas.toDataURL("image/png");
          pdf.addImage(imgData, 'PNG', 10, 10, 180, 160);
          pdf.save(filename + '.pdf');
        }
      });
    }

    // Your charts will be populated using embedded or separate JS based on the CSV files youâ€™ve uploaded
    // Placeholder for loading and rendering CSV data using fetch or embedded datasets
  </script>
</body>
</html>
